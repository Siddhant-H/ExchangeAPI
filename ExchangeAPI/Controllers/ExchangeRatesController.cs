using ExchangeAPI.Model;
using Microsoft.AspNetCore.Cors;
using Microsoft.AspNetCore.Mvc;
using Newtonsoft.Json;
using System.Net.Http;

namespace ExchangeAPI.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class ExchangeRatesController : ControllerBase
    {

        private readonly ILogger<ExchangeRatesController> _logger;

        private readonly AppDbContext _context;

        private readonly IConfiguration _configuration;

        public ExchangeRatesController(ILogger<ExchangeRatesController> logger, AppDbContext context, IConfiguration configuration)
        {
            _logger = logger;
            _context = context;
            _configuration = configuration;
        }


        [HttpPost]
        public async Task<IActionResult> AddData()
        {
            var jsonString = "{\"success\":true,\"timeseries\":true,\"start_date\":\"2023-05-01\",\"end_date\":\"2024-03-30\",\"base\":\"MXN\",\"rates\":{\"2023-05-01\":{\"USD\":0.055739,\"MXN\":1,\"CHF\":0.049943,\"EUR\":0.050817},\"2023-05-02\":{\"USD\":0.055629,\"MXN\":1,\"CHF\":0.049646,\"EUR\":0.050523},\"2023-05-03\":{\"USD\":0.055645,\"MXN\":1,\"CHF\":0.049161,\"EUR\":0.050273},\"2023-05-04\":{\"USD\":0.05586,\"MXN\":1,\"CHF\":0.049459,\"EUR\":0.050678},\"2023-05-05\":{\"USD\":0.056298,\"MXN\":1,\"CHF\":0.050528,\"EUR\":0.05022},\"2023-05-06\":{\"USD\":0.056298,\"MXN\":1,\"CHF\":0.050521,\"EUR\":0.05022},\"2023-05-07\":{\"USD\":0.056279,\"MXN\":1,\"CHF\":0.050157,\"EUR\":0.051077},\"2023-05-08\":{\"USD\":0.056211,\"MXN\":1,\"CHF\":0.050027,\"EUR\":0.051121},\"2023-05-09\":{\"USD\":0.056311,\"MXN\":1,\"CHF\":0.05013,\"EUR\":0.051358},\"2023-05-10\":{\"USD\":0.056973,\"MXN\":1,\"CHF\":0.050668,\"EUR\":0.05187},\"2023-05-11\":{\"USD\":0.056851,\"MXN\":1,\"CHF\":0.050837,\"EUR\":0.052101},\"2023-05-12\":{\"USD\":0.056825,\"MXN\":1,\"CHF\":0.051069,\"EUR\":0.051944},\"2023-05-13\":{\"USD\":0.056826,\"MXN\":1,\"CHF\":0.051022,\"EUR\":0.051945},\"2023-05-14\":{\"USD\":0.056822,\"MXN\":1,\"CHF\":0.051051,\"EUR\":0.052359},\"2023-05-15\":{\"USD\":0.057313,\"MXN\":1,\"CHF\":0.051325,\"EUR\":0.052709},\"2023-05-16\":{\"USD\":0.057158,\"MXN\":1,\"CHF\":0.051237,\"EUR\":0.052606},\"2023-05-17\":{\"USD\":0.056788,\"MXN\":1,\"CHF\":0.051043,\"EUR\":0.052397},\"2023-05-18\":{\"USD\":0.056438,\"MXN\":1,\"CHF\":0.051071,\"EUR\":0.052378},\"2023-05-19\":{\"USD\":0.05619,\"MXN\":1,\"CHF\":0.050548,\"EUR\":0.051914},\"2023-05-20\":{\"USD\":0.056191,\"MXN\":1,\"CHF\":0.050559,\"EUR\":0.051915},\"2023-05-21\":{\"USD\":0.056303,\"MXN\":1,\"CHF\":0.050576,\"EUR\":0.052024},\"2023-05-22\":{\"USD\":0.055882,\"MXN\":1,\"CHF\":0.050203,\"EUR\":0.051691},\"2023-05-23\":{\"USD\":0.055638,\"MXN\":1,\"CHF\":0.050159,\"EUR\":0.051664},\"2023-05-24\":{\"USD\":0.056159,\"MXN\":1,\"CHF\":0.050779,\"EUR\":0.052214},\"2023-05-25\":{\"USD\":0.055987,\"MXN\":1,\"CHF\":0.050674,\"EUR\":0.052207},\"2023-05-26\":{\"USD\":0.056722,\"MXN\":1,\"CHF\":0.051337,\"EUR\":0.052856},\"2023-05-27\":{\"USD\":0.056722,\"MXN\":1,\"CHF\":0.051411,\"EUR\":0.052856},\"2023-05-28\":{\"USD\":0.056763,\"MXN\":1,\"CHF\":0.051414,\"EUR\":0.052937},\"2023-05-29\":{\"USD\":0.056813,\"MXN\":1,\"CHF\":0.051388,\"EUR\":0.05306},\"2023-05-30\":{\"USD\":0.056591,\"MXN\":1,\"CHF\":0.051273,\"EUR\":0.052734},\"2023-05-31\":{\"USD\":0.056524,\"MXN\":1,\"CHF\":0.051443,\"EUR\":0.052859},\"2023-06-01\":{\"USD\":0.056968,\"MXN\":1,\"CHF\":0.051592,\"EUR\":0.052942},\"2023-06-02\":{\"USD\":0.056959,\"MXN\":1,\"CHF\":0.051787,\"EUR\":0.053106},\"2023-06-03\":{\"USD\":0.056959,\"MXN\":1,\"CHF\":0.051778,\"EUR\":0.053106},\"2023-06-04\":{\"USD\":0.05693,\"MXN\":1,\"CHF\":0.051794,\"EUR\":0.053218},\"2023-06-05\":{\"USD\":0.057261,\"MXN\":1,\"CHF\":0.051878,\"EUR\":0.053457},\"2023-06-06\":{\"USD\":0.057528,\"MXN\":1,\"CHF\":0.052189,\"EUR\":0.053776},\"2023-06-07\":{\"USD\":0.05761,\"MXN\":1,\"CHF\":0.052402,\"EUR\":0.053806},\"2023-06-08\":{\"USD\":0.057514,\"MXN\":1,\"CHF\":0.051699,\"EUR\":0.05334},\"2023-06-09\":{\"USD\":0.057866,\"MXN\":1,\"CHF\":0.052282,\"EUR\":0.053752},\"2023-06-10\":{\"USD\":0.057866,\"MXN\":1,\"CHF\":0.052257,\"EUR\":0.053752},\"2023-06-11\":{\"USD\":0.057851,\"MXN\":1,\"CHF\":0.052255,\"EUR\":0.053811},\"2023-06-12\":{\"USD\":0.057847,\"MXN\":1,\"CHF\":0.052554,\"EUR\":0.053748},\"2023-06-13\":{\"USD\":0.058015,\"MXN\":1,\"CHF\":0.052522,\"EUR\":0.053772},\"2023-06-14\":{\"USD\":0.058335,\"MXN\":1,\"CHF\":0.052518,\"EUR\":0.053801},\"2023-06-15\":{\"USD\":0.058381,\"MXN\":1,\"CHF\":0.052067,\"EUR\":0.053337},\"2023-06-16\":{\"USD\":0.058548,\"MXN\":1,\"CHF\":0.052318,\"EUR\":0.053416},\"2023-06-17\":{\"USD\":0.058548,\"MXN\":1,\"CHF\":0.05232,\"EUR\":0.053416},\"2023-06-18\":{\"USD\":0.058541,\"MXN\":1,\"CHF\":0.05236,\"EUR\":0.05351},\"2023-06-19\":{\"USD\":0.058558,\"MXN\":1,\"CHF\":0.052462,\"EUR\":0.053605},\"2023-06-20\":{\"USD\":0.058119,\"MXN\":1,\"CHF\":0.052176,\"EUR\":0.053222},\"2023-06-21\":{\"USD\":0.058369,\"MXN\":1,\"CHF\":0.052094,\"EUR\":0.053104},\"2023-06-22\":{\"USD\":0.058191,\"MXN\":1,\"CHF\":0.05208,\"EUR\":0.053105},\"2023-06-23\":{\"USD\":0.058265,\"MXN\":1,\"CHF\":0.052252,\"EUR\":0.053301},\"2023-06-24\":{\"USD\":0.058265,\"MXN\":1,\"CHF\":0.052243,\"EUR\":0.053301},\"2023-06-25\":{\"USD\":0.058268,\"MXN\":1,\"CHF\":0.052198,\"EUR\":0.053426},\"2023-06-26\":{\"USD\":0.05837,\"MXN\":1,\"CHF\":0.052289,\"EUR\":0.053501},\"2023-06-27\":{\"USD\":0.058509,\"MXN\":1,\"CHF\":0.052295,\"EUR\":0.053399},\"2023-06-28\":{\"USD\":0.058487,\"MXN\":1,\"CHF\":0.052449,\"EUR\":0.053581},\"2023-06-29\":{\"USD\":0.058407,\"MXN\":1,\"CHF\":0.05252,\"EUR\":0.053744},\"2023-06-30\":{\"USD\":0.058397,\"MXN\":1,\"CHF\":0.052271,\"EUR\":0.053494},\"2023-07-01\":{\"USD\":0.058397,\"MXN\":1,\"CHF\":0.05225,\"EUR\":0.053494},\"2023-07-02\":{\"USD\":0.0584,\"MXN\":1,\"CHF\":0.05228,\"EUR\":0.053547},\"2023-07-03\":{\"USD\":0.05861,\"MXN\":1,\"CHF\":0.052515,\"EUR\":0.053708},\"2023-07-04\":{\"USD\":0.058649,\"MXN\":1,\"CHF\":0.052599,\"EUR\":0.053887},\"2023-07-05\":{\"USD\":0.058794,\"MXN\":1,\"CHF\":0.05283,\"EUR\":0.054161},\"2023-07-06\":{\"USD\":0.058024,\"MXN\":1,\"CHF\":0.05195,\"EUR\":0.05328},\"2023-07-07\":{\"USD\":0.058319,\"MXN\":1,\"CHF\":0.051828,\"EUR\":0.05314},\"2023-07-08\":{\"USD\":0.058319,\"MXN\":1,\"CHF\":0.05183,\"EUR\":0.05314},\"2023-07-09\":{\"USD\":0.058308,\"MXN\":1,\"CHF\":0.051841,\"EUR\":0.053159},\"2023-07-10\":{\"USD\":0.058618,\"MXN\":1,\"CHF\":0.051887,\"EUR\":0.053262},\"2023-07-11\":{\"USD\":0.058672,\"MXN\":1,\"CHF\":0.051562,\"EUR\":0.053272},\"2023-07-12\":{\"USD\":0.059177,\"MXN\":1,\"CHF\":0.051289,\"EUR\":0.053108},\"2023-07-13\":{\"USD\":0.059327,\"MXN\":1,\"CHF\":0.050973,\"EUR\":0.052862},\"2023-07-14\":{\"USD\":0.059697,\"MXN\":1,\"CHF\":0.05153,\"EUR\":0.053079},\"2023-07-15\":{\"USD\":0.059716,\"MXN\":1,\"CHF\":0.051551,\"EUR\":0.053097},\"2023-07-16\":{\"USD\":0.059688,\"MXN\":1,\"CHF\":0.051457,\"EUR\":0.053164},\"2023-07-17\":{\"USD\":0.059778,\"MXN\":1,\"CHF\":0.051433,\"EUR\":0.053196},\"2023-07-18\":{\"USD\":0.059685,\"MXN\":1,\"CHF\":0.051193,\"EUR\":0.053154},\"2023-07-19\":{\"USD\":0.059828,\"MXN\":1,\"CHF\":0.051333,\"EUR\":0.053394},\"2023-07-20\":{\"USD\":0.059257,\"MXN\":1,\"CHF\":0.051336,\"EUR\":0.053213},\"2023-07-21\":{\"USD\":0.058856,\"MXN\":1,\"CHF\":0.050976,\"EUR\":0.052865},\"2023-07-22\":{\"USD\":0.058856,\"MXN\":1,\"CHF\":0.050968,\"EUR\":0.052865},\"2023-07-23\":{\"USD\":0.058861,\"MXN\":1,\"CHF\":0.050991,\"EUR\":0.052909},\"2023-07-24\":{\"USD\":0.059379,\"MXN\":1,\"CHF\":0.051658,\"EUR\":0.053674},\"2023-07-25\":{\"USD\":0.059026,\"MXN\":1,\"CHF\":0.051034,\"EUR\":0.053416},\"2023-07-26\":{\"USD\":0.059295,\"MXN\":1,\"CHF\":0.051089,\"EUR\":0.053524},\"2023-07-27\":{\"USD\":0.059305,\"MXN\":1,\"CHF\":0.05153,\"EUR\":0.054019},\"2023-07-28\":{\"USD\":0.059918,\"MXN\":1,\"CHF\":0.052167,\"EUR\":0.054315},\"2023-07-29\":{\"USD\":0.059918,\"MXN\":1,\"CHF\":0.052137,\"EUR\":0.054315},\"2023-07-30\":{\"USD\":0.05994,\"MXN\":1,\"CHF\":0.05214,\"EUR\":0.054372},\"2023-07-31\":{\"USD\":0.05969,\"MXN\":1,\"CHF\":0.052033,\"EUR\":0.054277},\"2023-08-01\":{\"USD\":0.059256,\"MXN\":1,\"CHF\":0.051706,\"EUR\":0.053831},\"2023-08-02\":{\"USD\":0.058769,\"MXN\":1,\"CHF\":0.051562,\"EUR\":0.053701},\"2023-08-03\":{\"USD\":0.057709,\"MXN\":1,\"CHF\":0.050455,\"EUR\":0.052696},\"2023-08-04\":{\"USD\":0.058553,\"MXN\":1,\"CHF\":0.051089,\"EUR\":0.05311},\"2023-08-05\":{\"USD\":0.058553,\"MXN\":1,\"CHF\":0.051094,\"EUR\":0.05311},\"2023-08-06\":{\"USD\":0.058536,\"MXN\":1,\"CHF\":0.051173,\"EUR\":0.053203},\"2023-08-07\":{\"USD\":0.058549,\"MXN\":1,\"CHF\":0.051107,\"EUR\":0.053213},\"2023-08-08\":{\"USD\":0.058406,\"MXN\":1,\"CHF\":0.051145,\"EUR\":0.053297},\"2023-08-09\":{\"USD\":0.058608,\"MXN\":1,\"CHF\":0.051394,\"EUR\":0.05339},\"2023-08-10\":{\"USD\":0.058539,\"MXN\":1,\"CHF\":0.051331,\"EUR\":0.053307},\"2023-08-11\":{\"USD\":0.058779,\"MXN\":1,\"CHF\":0.051537,\"EUR\":0.053612},\"2023-08-12\":{\"USD\":0.058779,\"MXN\":1,\"CHF\":0.051542,\"EUR\":0.053612},\"2023-08-13\":{\"USD\":0.058836,\"MXN\":1,\"CHF\":0.05158,\"EUR\":0.05376},\"2023-08-14\":{\"USD\":0.058616,\"MXN\":1,\"CHF\":0.051468,\"EUR\":0.053733},\"2023-08-15\":{\"USD\":0.058373,\"MXN\":1,\"CHF\":0.051293,\"EUR\":0.053534},\"2023-08-16\":{\"USD\":0.05832,\"MXN\":1,\"CHF\":0.051332,\"EUR\":0.053629},\"2023-08-17\":{\"USD\":0.058478,\"MXN\":1,\"CHF\":0.051363,\"EUR\":0.053776},\"2023-08-18\":{\"USD\":0.058623,\"MXN\":1,\"CHF\":0.051708,\"EUR\":0.05384},\"2023-08-19\":{\"USD\":0.058623,\"MXN\":1,\"CHF\":0.051708,\"EUR\":0.05384},\"2023-08-20\":{\"USD\":0.058682,\"MXN\":1,\"CHF\":0.051777,\"EUR\":0.053959},\"2023-08-21\":{\"USD\":0.058727,\"MXN\":1,\"CHF\":0.051594,\"EUR\":0.053889},\"2023-08-22\":{\"USD\":0.05914,\"MXN\":1,\"CHF\":0.052059,\"EUR\":0.054525},\"2023-08-23\":{\"USD\":0.059545,\"MXN\":1,\"CHF\":0.052249,\"EUR\":0.054802},\"2023-08-24\":{\"USD\":0.059407,\"MXN\":1,\"CHF\":0.052593,\"EUR\":0.055014},\"2023-08-25\":{\"USD\":0.059686,\"MXN\":1,\"CHF\":0.052801,\"EUR\":0.055293},\"2023-08-26\":{\"USD\":0.059686,\"MXN\":1,\"CHF\":0.052793,\"EUR\":0.055293},\"2023-08-27\":{\"USD\":0.059759,\"MXN\":1,\"CHF\":0.052874,\"EUR\":0.055347},\"2023-08-28\":{\"USD\":0.059563,\"MXN\":1,\"CHF\":0.052628,\"EUR\":0.055022},\"2023-08-29\":{\"USD\":0.059518,\"MXN\":1,\"CHF\":0.052317,\"EUR\":0.05476},\"2023-08-30\":{\"USD\":0.059669,\"MXN\":1,\"CHF\":0.052398,\"EUR\":0.054588},\"2023-08-31\":{\"USD\":0.058821,\"MXN\":1,\"CHF\":0.051954,\"EUR\":0.054244},\"2023-09-01\":{\"USD\":0.058508,\"MXN\":1,\"CHF\":0.05185,\"EUR\":0.054196},\"2023-09-02\":{\"USD\":0.058508,\"MXN\":1,\"CHF\":0.051833,\"EUR\":0.054196},\"2023-09-03\":{\"USD\":0.058563,\"MXN\":1,\"CHF\":0.051846,\"EUR\":0.054347},\"2023-09-04\":{\"USD\":0.058212,\"MXN\":1,\"CHF\":0.051508,\"EUR\":0.053936},\"2023-09-05\":{\"USD\":0.057479,\"MXN\":1,\"CHF\":0.051126,\"EUR\":0.053596},\"2023-09-06\":{\"USD\":0.056838,\"MXN\":1,\"CHF\":0.050667,\"EUR\":0.053002},\"2023-09-07\":{\"USD\":0.056843,\"MXN\":1,\"CHF\":0.050746,\"EUR\":0.053137},\"2023-09-08\":{\"USD\":0.056829,\"MXN\":1,\"CHF\":0.050738,\"EUR\":0.053053},\"2023-09-09\":{\"USD\":0.056829,\"MXN\":1,\"CHF\":0.050729,\"EUR\":0.053053},\"2023-09-10\":{\"USD\":0.056965,\"MXN\":1,\"CHF\":0.050817,\"EUR\":0.053157},\"2023-09-11\":{\"USD\":0.057855,\"MXN\":1,\"CHF\":0.051566,\"EUR\":0.053826},\"2023-09-12\":{\"USD\":0.058054,\"MXN\":1,\"CHF\":0.051753,\"EUR\":0.05399},\"2023-09-13\":{\"USD\":0.058324,\"MXN\":1,\"CHF\":0.052107,\"EUR\":0.054343},\"2023-09-14\":{\"USD\":0.058448,\"MXN\":1,\"CHF\":0.052383,\"EUR\":0.054956},\"2023-09-15\":{\"USD\":0.05855,\"MXN\":1,\"CHF\":0.052538,\"EUR\":0.054856},\"2023-09-16\":{\"USD\":0.05855,\"MXN\":1,\"CHF\":0.052542,\"EUR\":0.054856},\"2023-09-17\":{\"USD\":0.058608,\"MXN\":1,\"CHF\":0.052568,\"EUR\":0.054939},\"2023-09-18\":{\"USD\":0.058371,\"MXN\":1,\"CHF\":0.052377,\"EUR\":0.054592},\"2023-09-19\":{\"USD\":0.058591,\"MXN\":1,\"CHF\":0.052578,\"EUR\":0.054852},\"2023-09-20\":{\"USD\":0.058497,\"MXN\":1,\"CHF\":0.052612,\"EUR\":0.05492},\"2023-09-21\":{\"USD\":0.058051,\"MXN\":1,\"CHF\":0.052518,\"EUR\":0.054452},\"2023-09-22\":{\"USD\":0.058093,\"MXN\":1,\"CHF\":0.052656,\"EUR\":0.054436},\"2023-09-23\":{\"USD\":0.058093,\"MXN\":1,\"CHF\":0.052668,\"EUR\":0.054436},\"2023-09-24\":{\"USD\":0.058178,\"MXN\":1,\"CHF\":0.052785,\"EUR\":0.054638},\"2023-09-25\":{\"USD\":0.057473,\"MXN\":1,\"CHF\":0.052426,\"EUR\":0.054264},\"2023-09-26\":{\"USD\":0.056988,\"MXN\":1,\"CHF\":0.052192,\"EUR\":0.053919},\"2023-09-27\":{\"USD\":0.056529,\"MXN\":1,\"CHF\":0.052056,\"EUR\":0.053812},\"2023-09-28\":{\"USD\":0.057007,\"MXN\":1,\"CHF\":0.052152,\"EUR\":0.053972},\"2023-09-29\":{\"USD\":0.057409,\"MXN\":1,\"CHF\":0.052552,\"EUR\":0.054229},\"2023-09-30\":{\"USD\":0.057409,\"MXN\":1,\"CHF\":0.052561,\"EUR\":0.054229},\"2023-10-01\":{\"USD\":0.057437,\"MXN\":1,\"CHF\":0.052585,\"EUR\":0.054373},\"2023-10-02\":{\"USD\":0.056569,\"MXN\":1,\"CHF\":0.051928,\"EUR\":0.053977},\"2023-10-03\":{\"USD\":0.05548,\"MXN\":1,\"CHF\":0.0511,\"EUR\":0.052986},\"2023-10-04\":{\"USD\":0.055577,\"MXN\":1,\"CHF\":0.050954,\"EUR\":0.052897},\"2023-10-05\":{\"USD\":0.054698,\"MXN\":1,\"CHF\":0.049929,\"EUR\":0.051865},\"2023-10-06\":{\"USD\":0.05506,\"MXN\":1,\"CHF\":0.050126,\"EUR\":0.051941},\"2023-10-07\":{\"USD\":0.05506,\"MXN\":1,\"CHF\":0.050098,\"EUR\":0.051941},\"2023-10-08\":{\"USD\":0.054816,\"MXN\":1,\"CHF\":0.049822,\"EUR\":0.051878},\"2023-10-09\":{\"USD\":0.054914,\"MXN\":1,\"CHF\":0.049699,\"EUR\":0.05191},\"2023-10-10\":{\"USD\":0.05575,\"MXN\":1,\"CHF\":0.050434,\"EUR\":0.052573},\"2023-10-11\":{\"USD\":0.056029,\"MXN\":1,\"CHF\":0.050486,\"EUR\":0.052738},\"2023-10-12\":{\"USD\":0.055638,\"MXN\":1,\"CHF\":0.050513,\"EUR\":0.052806},\"2023-10-13\":{\"USD\":0.055275,\"MXN\":1,\"CHF\":0.049925,\"EUR\":0.052569},\"2023-10-14\":{\"USD\":0.055275,\"MXN\":1,\"CHF\":0.049977,\"EUR\":0.052569},\"2023-10-15\":{\"USD\":0.055392,\"MXN\":1,\"CHF\":0.049995,\"EUR\":0.052649},\"2023-10-16\":{\"USD\":0.055834,\"MXN\":1,\"CHF\":0.050279,\"EUR\":0.052903},\"2023-10-17\":{\"USD\":0.055504,\"MXN\":1,\"CHF\":0.049963,\"EUR\":0.052504},\"2023-10-18\":{\"USD\":0.054794,\"MXN\":1,\"CHF\":0.049248,\"EUR\":0.051995},\"2023-10-19\":{\"USD\":0.054575,\"MXN\":1,\"CHF\":0.048674,\"EUR\":0.051559},\"2023-10-20\":{\"USD\":0.054839,\"MXN\":1,\"CHF\":0.048974,\"EUR\":0.051727},\"2023-10-21\":{\"USD\":0.054839,\"MXN\":1,\"CHF\":0.048972,\"EUR\":0.051727},\"2023-10-22\":{\"USD\":0.054896,\"MXN\":1,\"CHF\":0.049045,\"EUR\":0.05184},\"2023-10-23\":{\"USD\":0.055105,\"MXN\":1,\"CHF\":0.049087,\"EUR\":0.051647},\"2023-10-24\":{\"USD\":0.054759,\"MXN\":1,\"CHF\":0.048907,\"EUR\":0.051684},\"2023-10-25\":{\"USD\":0.054518,\"MXN\":1,\"CHF\":0.048898,\"EUR\":0.051593},\"2023-10-26\":{\"USD\":0.055093,\"MXN\":1,\"CHF\":0.049522,\"EUR\":0.052151},\"2023-10-27\":{\"USD\":0.055202,\"MXN\":1,\"CHF\":0.049812,\"EUR\":0.052183},\"2023-10-28\":{\"USD\":0.055202,\"MXN\":1,\"CHF\":0.04979,\"EUR\":0.052183},\"2023-10-29\":{\"USD\":0.05522,\"MXN\":1,\"CHF\":0.049817,\"EUR\":0.052273},\"2023-10-30\":{\"USD\":0.055361,\"MXN\":1,\"CHF\":0.049944,\"EUR\":0.052156},\"2023-10-31\":{\"USD\":0.055366,\"MXN\":1,\"CHF\":0.050376,\"EUR\":0.052337},\"2023-11-01\":{\"USD\":0.05629,\"MXN\":1,\"CHF\":0.050988,\"EUR\":0.05318},\"2023-11-02\":{\"USD\":0.057006,\"MXN\":1,\"CHF\":0.051657,\"EUR\":0.053691},\"2023-11-03\":{\"USD\":0.057261,\"MXN\":1,\"CHF\":0.05148,\"EUR\":0.053336},\"2023-11-04\":{\"USD\":0.057261,\"MXN\":1,\"CHF\":0.05148,\"EUR\":0.053336},\"2023-11-05\":{\"USD\":0.057221,\"MXN\":1,\"CHF\":0.051451,\"EUR\":0.053318},\"2023-11-06\":{\"USD\":0.056979,\"MXN\":1,\"CHF\":0.051247,\"EUR\":0.053153},\"2023-11-07\":{\"USD\":0.057194,\"MXN\":1,\"CHF\":0.051474,\"EUR\":0.053471},\"2023-11-08\":{\"USD\":0.057012,\"MXN\":1,\"CHF\":0.051263,\"EUR\":0.053233},\"2023-11-09\":{\"USD\":0.056197,\"MXN\":1,\"CHF\":0.050757,\"EUR\":0.052685},\"2023-11-10\":{\"USD\":0.056668,\"MXN\":1,\"CHF\":0.051166,\"EUR\":0.052889},\"2023-11-11\":{\"USD\":0.056668,\"MXN\":1,\"CHF\":0.051165,\"EUR\":0.052889},\"2023-11-12\":{\"USD\":0.056616,\"MXN\":1,\"CHF\":0.05107,\"EUR\":0.052963},\"2023-11-13\":{\"USD\":0.056769,\"MXN\":1,\"CHF\":0.051172,\"EUR\":0.05305},\"2023-11-14\":{\"USD\":0.057646,\"MXN\":1,\"CHF\":0.051246,\"EUR\":0.052986},\"2023-11-15\":{\"USD\":0.057807,\"MXN\":1,\"CHF\":0.051297,\"EUR\":0.053265},\"2023-11-16\":{\"USD\":0.057999,\"MXN\":1,\"CHF\":0.051535,\"EUR\":0.053439},\"2023-11-17\":{\"USD\":0.058043,\"MXN\":1,\"CHF\":0.051409,\"EUR\":0.05317},\"2023-11-18\":{\"USD\":0.058043,\"MXN\":1,\"CHF\":0.051413,\"EUR\":0.05317},\"2023-11-19\":{\"USD\":0.058051,\"MXN\":1,\"CHF\":0.051433,\"EUR\":0.053225},\"2023-11-20\":{\"USD\":0.058433,\"MXN\":1,\"CHF\":0.05168,\"EUR\":0.053387},\"2023-11-21\":{\"USD\":0.058124,\"MXN\":1,\"CHF\":0.051346,\"EUR\":0.053244},\"2023-11-22\":{\"USD\":0.058143,\"MXN\":1,\"CHF\":0.051406,\"EUR\":0.053398},\"2023-11-23\":{\"USD\":0.058173,\"MXN\":1,\"CHF\":0.051456,\"EUR\":0.053348},\"2023-11-24\":{\"USD\":0.058422,\"MXN\":1,\"CHF\":0.051569,\"EUR\":0.053357},\"2023-11-25\":{\"USD\":0.058422,\"MXN\":1,\"CHF\":0.051574,\"EUR\":0.053357},\"2023-11-26\":{\"USD\":0.058417,\"MXN\":1,\"CHF\":0.05154,\"EUR\":0.053397},\"2023-11-27\":{\"USD\":0.058229,\"MXN\":1,\"CHF\":0.051253,\"EUR\":0.053138},\"2023-11-28\":{\"USD\":0.058357,\"MXN\":1,\"CHF\":0.051185,\"EUR\":0.053029},\"2023-11-29\":{\"USD\":0.057811,\"MXN\":1,\"CHF\":0.05049,\"EUR\":0.052684},\"2023-11-30\":{\"USD\":0.057504,\"MXN\":1,\"CHF\":0.05031,\"EUR\":0.052794},\"2023-12-01\":{\"USD\":0.058184,\"MXN\":1,\"CHF\":0.050632,\"EUR\":0.053416},\"2023-12-02\":{\"USD\":0.058186,\"MXN\":1,\"CHF\":0.050626,\"EUR\":0.053447},\"2023-12-03\":{\"USD\":0.058164,\"MXN\":1,\"CHF\":0.050481,\"EUR\":0.053422},\"2023-12-04\":{\"USD\":0.057244,\"MXN\":1,\"CHF\":0.049949,\"EUR\":0.052821},\"2023-12-05\":{\"USD\":0.05756,\"MXN\":1,\"CHF\":0.050369,\"EUR\":0.053329},\"2023-12-06\":{\"USD\":0.057831,\"MXN\":1,\"CHF\":0.050583,\"EUR\":0.053717},\"2023-12-07\":{\"USD\":0.057225,\"MXN\":1,\"CHF\":0.050101,\"EUR\":0.053034},\"2023-12-08\":{\"USD\":0.057643,\"MXN\":1,\"CHF\":0.050721,\"EUR\":0.053505},\"2023-12-09\":{\"USD\":0.057643,\"MXN\":1,\"CHF\":0.05073,\"EUR\":0.053505},\"2023-12-10\":{\"USD\":0.057634,\"MXN\":1,\"CHF\":0.0507,\"EUR\":0.053543},\"2023-12-11\":{\"USD\":0.057521,\"MXN\":1,\"CHF\":0.050521,\"EUR\":0.053431},\"2023-12-12\":{\"USD\":0.057782,\"MXN\":1,\"CHF\":0.05057,\"EUR\":0.053511},\"2023-12-13\":{\"USD\":0.057921,\"MXN\":1,\"CHF\":0.050451,\"EUR\":0.053215},\"2023-12-14\":{\"USD\":0.05816,\"MXN\":1,\"CHF\":0.050437,\"EUR\":0.052904},\"2023-12-15\":{\"USD\":0.058133,\"MXN\":1,\"CHF\":0.050547,\"EUR\":0.053296},\"2023-12-16\":{\"USD\":0.058131,\"MXN\":1,\"CHF\":0.050517,\"EUR\":0.053295},\"2023-12-17\":{\"USD\":0.058044,\"MXN\":1,\"CHF\":0.050539,\"EUR\":0.053276},\"2023-12-18\":{\"USD\":0.058257,\"MXN\":1,\"CHF\":0.05052,\"EUR\":0.053333},\"2023-12-19\":{\"USD\":0.058566,\"MXN\":1,\"CHF\":0.050398,\"EUR\":0.053335},\"2023-12-20\":{\"USD\":0.058355,\"MXN\":1,\"CHF\":0.050341,\"EUR\":0.053319},\"2023-12-21\":{\"USD\":0.058704,\"MXN\":1,\"CHF\":0.05027,\"EUR\":0.053339},\"2023-12-22\":{\"USD\":0.05891,\"MXN\":1,\"CHF\":0.050421,\"EUR\":0.053434},\"2023-12-23\":{\"USD\":0.05891,\"MXN\":1,\"CHF\":0.050421,\"EUR\":0.053434},\"2023-12-24\":{\"USD\":0.058783,\"MXN\":1,\"CHF\":0.050317,\"EUR\":0.053319},\"2023-12-25\":{\"USD\":0.058857,\"MXN\":1,\"CHF\":0.050382,\"EUR\":0.053412},\"2023-12-26\":{\"USD\":0.058863,\"MXN\":1,\"CHF\":0.050256,\"EUR\":0.053306},\"2023-12-27\":{\"USD\":0.059072,\"MXN\":1,\"CHF\":0.04977,\"EUR\":0.053178},\"2023-12-28\":{\"USD\":0.058941,\"MXN\":1,\"CHF\":0.049722,\"EUR\":0.053255},\"2023-12-29\":{\"USD\":0.058923,\"MXN\":1,\"CHF\":0.049561,\"EUR\":0.053302},\"2023-12-30\":{\"USD\":0.058923,\"MXN\":1,\"CHF\":0.049548,\"EUR\":0.053302},\"2023-12-31\":{\"USD\":0.058913,\"MXN\":1,\"CHF\":0.049545,\"EUR\":0.053293},\"2024-01-01\":{\"USD\":0.058939,\"MXN\":1,\"CHF\":0.049624,\"EUR\":0.053398},\"2024-01-02\":{\"USD\":0.058705,\"MXN\":1,\"CHF\":0.04991,\"EUR\":0.053654},\"2024-01-03\":{\"USD\":0.05877,\"MXN\":1,\"CHF\":0.049902,\"EUR\":0.053787},\"2024-01-04\":{\"USD\":0.058742,\"MXN\":1,\"CHF\":0.049942,\"EUR\":0.053661},\"2024-01-05\":{\"USD\":0.059241,\"MXN\":1,\"CHF\":0.050338,\"EUR\":0.054078},\"2024-01-06\":{\"USD\":0.059241,\"MXN\":1,\"CHF\":0.05034,\"EUR\":0.054078},\"2024-01-07\":{\"USD\":0.059223,\"MXN\":1,\"CHF\":0.050388,\"EUR\":0.054126},\"2024-01-08\":{\"USD\":0.059396,\"MXN\":1,\"CHF\":0.050374,\"EUR\":0.05424},\"2024-01-09\":{\"USD\":0.05892,\"MXN\":1,\"CHF\":0.050227,\"EUR\":0.0539},\"2024-01-10\":{\"USD\":0.058878,\"MXN\":1,\"CHF\":0.050087,\"EUR\":0.053649},\"2024-01-11\":{\"USD\":0.059157,\"MXN\":1,\"CHF\":0.050347,\"EUR\":0.053871},\"2024-01-12\":{\"USD\":0.059284,\"MXN\":1,\"CHF\":0.050549,\"EUR\":0.054079},\"2024-01-13\":{\"USD\":0.059284,\"MXN\":1,\"CHF\":0.050549,\"EUR\":0.054079},\"2024-01-14\":{\"USD\":0.05927,\"MXN\":1,\"CHF\":0.05058,\"EUR\":0.054152},\"2024-01-15\":{\"USD\":0.05917,\"MXN\":1,\"CHF\":0.050645,\"EUR\":0.054059},\"2024-01-16\":{\"USD\":0.058096,\"MXN\":1,\"CHF\":0.05005,\"EUR\":0.053405},\"2024-01-17\":{\"USD\":0.058114,\"MXN\":1,\"CHF\":0.050234,\"EUR\":0.053388},\"2024-01-18\":{\"USD\":0.058238,\"MXN\":1,\"CHF\":0.050559,\"EUR\":0.053534},\"2024-01-19\":{\"USD\":0.058529,\"MXN\":1,\"CHF\":0.050821,\"EUR\":0.053625},\"2024-01-20\":{\"USD\":0.058529,\"MXN\":1,\"CHF\":0.050822,\"EUR\":0.053625},\"2024-01-21\":{\"USD\":0.058484,\"MXN\":1,\"CHF\":0.050797,\"EUR\":0.053697},\"2024-01-22\":{\"USD\":0.058174,\"MXN\":1,\"CHF\":0.050562,\"EUR\":0.053483},\"2024-01-23\":{\"USD\":0.057776,\"MXN\":1,\"CHF\":0.050249,\"EUR\":0.053217},\"2024-01-24\":{\"USD\":0.058015,\"MXN\":1,\"CHF\":0.05007,\"EUR\":0.053314},\"2024-01-25\":{\"USD\":0.058124,\"MXN\":1,\"CHF\":0.0504,\"EUR\":0.053588},\"2024-01-26\":{\"USD\":0.058277,\"MXN\":1,\"CHF\":0.050322,\"EUR\":0.053644},\"2024-01-27\":{\"USD\":0.058277,\"MXN\":1,\"CHF\":0.050326,\"EUR\":0.053644},\"2024-01-28\":{\"USD\":0.058228,\"MXN\":1,\"CHF\":0.050322,\"EUR\":0.053701},\"2024-01-29\":{\"USD\":0.058065,\"MXN\":1,\"CHF\":0.050016,\"EUR\":0.053595},\"2024-01-30\":{\"USD\":0.05829,\"MXN\":1,\"CHF\":0.050242,\"EUR\":0.053758},\"2024-01-31\":{\"USD\":0.058071,\"MXN\":1,\"CHF\":0.050083,\"EUR\":0.053752},\"2024-02-01\":{\"USD\":0.058539,\"MXN\":1,\"CHF\":0.050208,\"EUR\":0.053833},\"2024-02-02\":{\"USD\":0.058372,\"MXN\":1,\"CHF\":0.050619,\"EUR\":0.054015},\"2024-02-03\":{\"USD\":0.058372,\"MXN\":1,\"CHF\":0.050609,\"EUR\":0.054015},\"2024-02-04\":{\"USD\":0.058296,\"MXN\":1,\"CHF\":0.050543,\"EUR\":0.054077},\"2024-02-05\":{\"USD\":0.058397,\"MXN\":1,\"CHF\":0.05085,\"EUR\":0.054366},\"2024-02-06\":{\"USD\":0.058675,\"MXN\":1,\"CHF\":0.051023,\"EUR\":0.054548},\"2024-02-07\":{\"USD\":0.058615,\"MXN\":1,\"CHF\":0.051239,\"EUR\":0.054398},\"2024-02-08\":{\"USD\":0.05832,\"MXN\":1,\"CHF\":0.050944,\"EUR\":0.054117},\"2024-02-09\":{\"USD\":0.058524,\"MXN\":1,\"CHF\":0.051211,\"EUR\":0.054267},\"2024-02-10\":{\"USD\":0.058524,\"MXN\":1,\"CHF\":0.051207,\"EUR\":0.054266},\"2024-02-11\":{\"USD\":0.058552,\"MXN\":1,\"CHF\":0.051187,\"EUR\":0.054225},\"2024-02-12\":{\"USD\":0.058582,\"MXN\":1,\"CHF\":0.05131,\"EUR\":0.054384},\"2024-02-13\":{\"USD\":0.058122,\"MXN\":1,\"CHF\":0.051586,\"EUR\":0.054271},\"2024-02-14\":{\"USD\":0.058513,\"MXN\":1,\"CHF\":0.051801,\"EUR\":0.054523},\"2024-02-15\":{\"USD\":0.058674,\"MXN\":1,\"CHF\":0.051625,\"EUR\":0.054462},\"2024-02-16\":{\"USD\":0.058642,\"MXN\":1,\"CHF\":0.051643,\"EUR\":0.054411},\"2024-02-17\":{\"USD\":0.058642,\"MXN\":1,\"CHF\":0.051648,\"EUR\":0.054411},\"2024-02-18\":{\"USD\":0.05866,\"MXN\":1,\"CHF\":0.051662,\"EUR\":0.054392},\"2024-02-19\":{\"USD\":0.058654,\"MXN\":1,\"CHF\":0.051782,\"EUR\":0.054435},\"2024-02-20\":{\"USD\":0.058607,\"MXN\":1,\"CHF\":0.051682,\"EUR\":0.054209},\"2024-02-21\":{\"USD\":0.058658,\"MXN\":1,\"CHF\":0.051578,\"EUR\":0.054212},\"2024-02-22\":{\"USD\":0.058445,\"MXN\":1,\"CHF\":0.051435,\"EUR\":0.05399},\"2024-02-23\":{\"USD\":0.058424,\"MXN\":1,\"CHF\":0.051448,\"EUR\":0.053928},\"2024-02-24\":{\"USD\":0.058424,\"MXN\":1,\"CHF\":0.051448,\"EUR\":0.053928},\"2024-02-25\":{\"USD\":0.058422,\"MXN\":1,\"CHF\":0.051488,\"EUR\":0.053996},\"2024-02-26\":{\"USD\":0.058493,\"MXN\":1,\"CHF\":0.051489,\"EUR\":0.053908},\"2024-02-27\":{\"USD\":0.058584,\"MXN\":1,\"CHF\":0.051492,\"EUR\":0.054026},\"2024-02-28\":{\"USD\":0.058472,\"MXN\":1,\"CHF\":0.051388,\"EUR\":0.053952},\"2024-02-29\":{\"USD\":0.058641,\"MXN\":1,\"CHF\":0.051874,\"EUR\":0.054275},\"2024-03-01\":{\"USD\":0.058769,\"MXN\":1,\"CHF\":0.051976,\"EUR\":0.054161},\"2024-03-02\":{\"USD\":0.058769,\"MXN\":1,\"CHF\":0.051966,\"EUR\":0.054161},\"2024-03-03\":{\"USD\":0.058782,\"MXN\":1,\"CHF\":0.051927,\"EUR\":0.054216},\"2024-03-04\":{\"USD\":0.058971,\"MXN\":1,\"CHF\":0.052213,\"EUR\":0.054328},\"2024-03-05\":{\"USD\":0.059006,\"MXN\":1,\"CHF\":0.052142,\"EUR\":0.054354},\"2024-03-06\":{\"USD\":0.059232,\"MXN\":1,\"CHF\":0.052256,\"EUR\":0.054346},\"2024-03-07\":{\"USD\":0.059243,\"MXN\":1,\"CHF\":0.051974,\"EUR\":0.054104},\"2024-03-08\":{\"USD\":0.059525,\"MXN\":1,\"CHF\":0.052251,\"EUR\":0.054388},\"2024-03-09\":{\"USD\":0.059525,\"MXN\":1,\"CHF\":0.052248,\"EUR\":0.054388},\"2024-03-10\":{\"USD\":0.059503,\"MXN\":1,\"CHF\":0.052218,\"EUR\":0.054377},\"2024-03-11\":{\"USD\":0.059518,\"MXN\":1,\"CHF\":0.052215,\"EUR\":0.054449},\"2024-03-12\":{\"USD\":0.059526,\"MXN\":1,\"CHF\":0.052229,\"EUR\":0.054474},\"2024-03-13\":{\"USD\":0.05998,\"MXN\":1,\"CHF\":0.052689,\"EUR\":0.054759},\"2024-03-14\":{\"USD\":0.059864,\"MXN\":1,\"CHF\":0.05294,\"EUR\":0.055006},\"2024-03-15\":{\"USD\":0.059821,\"MXN\":1,\"CHF\":0.052918,\"EUR\":0.054889},\"2024-03-16\":{\"USD\":0.059821,\"MXN\":1,\"CHF\":0.052914,\"EUR\":0.054889},\"2024-03-17\":{\"USD\":0.059798,\"MXN\":1,\"CHF\":0.052841,\"EUR\":0.05495},\"2024-03-18\":{\"USD\":0.059398,\"MXN\":1,\"CHF\":0.052719,\"EUR\":0.054626},\"2024-03-19\":{\"USD\":0.059471,\"MXN\":1,\"CHF\":0.052846,\"EUR\":0.054746},\"2024-03-20\":{\"USD\":0.059942,\"MXN\":1,\"CHF\":0.053089,\"EUR\":0.054807},\"2024-03-21\":{\"USD\":0.059731,\"MXN\":1,\"CHF\":0.053626,\"EUR\":0.054991},\"2024-03-22\":{\"USD\":0.059644,\"MXN\":1,\"CHF\":0.053548,\"EUR\":0.054903},\"2024-03-23\":{\"USD\":0.059644,\"MXN\":1,\"CHF\":0.053557,\"EUR\":0.054903},\"2024-03-24\":{\"USD\":0.059663,\"MXN\":1,\"CHF\":0.053557,\"EUR\":0.055206},\"2024-03-25\":{\"USD\":0.059932,\"MXN\":1,\"CHF\":0.053911,\"EUR\":0.055298},\"2024-03-26\":{\"USD\":0.060072,\"MXN\":1,\"CHF\":0.054288,\"EUR\":0.055458},\"2024-03-27\":{\"USD\":0.060366,\"MXN\":1,\"CHF\":0.054673,\"EUR\":0.055826},\"2024-03-28\":{\"USD\":0.060204,\"MXN\":1,\"CHF\":0.054263,\"EUR\":0.055782},\"2024-03-29\":{\"USD\":0.060382,\"MXN\":1,\"CHF\":0.054471,\"EUR\":0.055911},\"2024-03-30\":{\"USD\":0.060382,\"MXN\":1,\"CHF\":0.054471,\"EUR\":0.055911}}}";

            var response = JsonConvert.DeserializeObject<ExchangeRateResponse>(jsonString);
            var exchangeRates = new List<exchangerates>();

            string baseCurrency = response.Base; // Assign the 'base' property to the output variable

            foreach (var rate in response.Rates)
            {
                // Parse the date string to DateTime and convert to UTC
                DateTime date;
                if (!DateTime.TryParseExact(rate.Key, "yyyy-MM-dd", null, System.Globalization.DateTimeStyles.None, out date))
                {
                    // Handle parsing error, if necessary
                }
                date = date.ToUniversalTime();

                var exchangeRate = new exchangerates
                {
                    date = date,
                    base_currency = baseCurrency,
                    USD = rate.Value.USD,
                    MXN = rate.Value.MXN,
                    CHF = rate.Value.CHF,
                    EUR = rate.Value.EUR
                };
                exchangeRates.Add(exchangeRate);
            }

            // Use the injected _context to add and save entities
            await _context.AddRangeAsync(exchangeRates);
            await _context.SaveChangesAsync();

            return Ok("Success");
        }


        [HttpGet]
        public IActionResult GetData()
        {
            var data = _context.exchangerates
                .Select(e => new exchangerates
                {
                    currency_id = e.currency_id,
                    base_currency = e.base_currency,
                    date = e.date,
                    USD = Convert.ToDecimal(e.USD),
                    MXN = Convert.ToDecimal(e.MXN),
                    EUR = Convert.ToDecimal(e.EUR),
                    CHF = Convert.ToDecimal(e.CHF)
                })
                .ToList();

            return Ok(data);
        }


        [HttpGet("ExchangeRate")]
        public IActionResult GetExchangeRateBetweenCurrencies(string source, string destination)
        {
            var latestExchangeRate = _context.exchangerates.OrderByDescending(e => e.date).FirstOrDefault();
            if (latestExchangeRate == null)
            {
                return NotFound("No exchange rate data found.");
            }

            decimal sourceValue;
            decimal destinationValue;

            switch (source.ToUpper())
            {
                case "USD":
                    sourceValue = latestExchangeRate.USD;
                    break;
                case "MXN":
                    sourceValue = latestExchangeRate.MXN;
                    break;
                case "EUR":
                    sourceValue = latestExchangeRate.EUR;
                    break;
                case "CHF":
                    sourceValue = latestExchangeRate.CHF;
                    break;
                default:
                    return BadRequest("Invalid source currency.");
            }

            switch (destination.ToUpper())
            {
                case "USD":
                    destinationValue = latestExchangeRate.USD;
                    break;
                case "MXN":
                    destinationValue = latestExchangeRate.MXN;
                    break;
                case "EUR":
                    destinationValue = latestExchangeRate.EUR;
                    break;
                case "CHF":
                    destinationValue = latestExchangeRate.CHF;
                    break;
                default:
                    return BadRequest("Invalid destination currency.");
            }

            return Ok(new
            {
                ExchangeRate = destinationValue / sourceValue,
                SourceCurrency = source.ToUpper(),
                DestinationCurrency = destination.ToUpper(),
                Date = latestExchangeRate.date
            });
        }


        [HttpPost("ExchangeRateByDate")]
        public IActionResult GetExchangeRateByDateAndCurrencies(DateTime date, string source, string[] destinations)
        {
            var dateUtc = DateTime.SpecifyKind(date, DateTimeKind.Utc);
            var exchangeRate = _context.exchangerates
                .Where(e => e.date <= dateUtc)
                .OrderByDescending(e => e.date)
                .FirstOrDefault();


            if (exchangeRate == null)
            {
                return NotFound("No exchange rate data found.");
            }

            var sourceValue = GetCurrencyValue(exchangeRate, source);
            if (sourceValue == null)
            {
                return BadRequest("Invalid source currency.");
            }

            var exchangeRates = new List<object>();
            foreach (var destination in destinations)
            {
                var destinationValue = GetCurrencyValue(exchangeRate, destination);
                if (destinationValue == null)
                {
                    return BadRequest($"Invalid destination currency: {destination}");
                }

                exchangeRates.Add(new
                {
                    ExchangeRate = destinationValue / sourceValue,
                    SourceCurrency = source.ToUpper(),
                    DestinationCurrency = destination.ToUpper(),
                    Date = exchangeRate.date
                });
            }

            return Ok(exchangeRates);
        }

        private decimal? GetCurrencyValue(exchangerates exchangeRate, string currency)
        {
            switch (currency.ToUpper())
            {
                case "USD":
                    return exchangeRate.USD;
                case "MXN":
                    return exchangeRate.MXN;
                case "EUR":
                    return exchangeRate.EUR;
                case "CHF":
                    return exchangeRate.CHF;
                default:
                    return null;
            }
        }

        [HttpPost("AverageExchangeRate")]
        public IActionResult GetAverageExchangeRateForCurrencies(DateTime startDate, DateTime endDate, string[] currencies)
        {
            DateTime utcStartDate = startDate.ToUniversalTime();
            DateTime utcEndDate = endDate.ToUniversalTime();

            var result = new List<object>();

            foreach (var currency in currencies)
            {
                var averageExchangeRate = _context.exchangerates
                    .Where(e => e.date >= utcStartDate && e.date <= utcEndDate)
                    .Average(GetCurrencyValue(currency));

                result.Add(new
                {
                    Currency = currency.ToUpper(),
                    AverageExchangeRate = averageExchangeRate
                });
            }

            return Ok(result);
        }



        private Func<exchangerates, decimal> GetCurrencyValue(string currency)
        {
            return currency.ToUpper() switch
            {
                "USD" => e => e.USD,
                "MXN" => e => e.MXN,
                "EUR" => e => e.EUR,
                "CHF" => e => e.CHF,
                _ => null
            };
        }


    }
}
